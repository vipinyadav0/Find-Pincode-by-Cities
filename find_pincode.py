import requests
from bs4 import BeautifulSoup
import re
from oauth2client.service_account import ServiceAccountCredentials
from googleapiclient.discovery import build
from cities import places


def search_pincode(search):
    '''
    :param search: search fior the state, city, or district
    :return: list of pinocodes
    '''
    pin_codes = []
    url = 'https://www.google.com/search?q=' + search + " " + 'pincode'
    result = requests.get(url)

    if result.status_code == 200:

        # Parse the HTML content of the page using BeautifulSoup
        soup = BeautifulSoup(result.content, 'html.parser')
        
        # Find all div tags on the page
        links = soup.find_all('div')
        if links:
            for link in links:
                text = link.get_text('Pin Code:')
        
                match = re.search(r'Pin Code:(\d{6})', text)  # Regex to match the pin code from the text say only digits and of length 6

                if match:
                    pin_code = match.group(1)
                    if pin_code:
                        return [search ,pin_code]
    else:
        print(f"Failed to crawl {url}")

    return pin_codes


# places = [
#     'Aarni',
#     'Aasta',
#     'Abhona',
#     'Address',
#     'Ahamadpur',
#     'Ahemednagar',
#     'Airoli',
#     'Ajanta',
#     'Ajmer',
#     'Ajmer Bus Stand',
#     'Ajmer Bus Stand',
#     'Ajmer Railway',
#     'Akluj',
#     'Akodiya',
#     'Akola',
#     'Akot',
#     'Akot',
#     'Akurdi, Pradhikaran',
#     'Alibaug',
#     'Allapalli',
#     'Amalner',
#     'Ambad',
#     'Ambegaon',
#     'Ambejogaie',
#     'Amravati',
#     'Andheri W',
#     'Andheri/Parle',
#     'Aurad',
#     'Aurangabad',
#     'Aurangabad',
#     'Aurangabad',
#     'Aurangabad',
#     'Ausa',
#     'Badnapur',
#     'Bali',
#     'Ballarpur',
#     'Balotra',
#     'Barali',
#     'Baramati',
#     'Baramati City',
#     'Barmer',
#     'Barmer',
#     'Barmer',
#     'Barmer',
#     'Barshi',
#     'Barshi/Paranda',
#     'Beawar',
#     'Beda',
#     'Beed',
#     'Bhadrawati',
#     'Bhandup',
#     'Bhandup / Vikroli',
#     'Bhatkeda',
#     'Bhayander',
#     'Bhigwan &Surrounding',
#     'Bhigwan Surrounding',
#     'Bhinmal',
#     'Bhiwandi',
#     'Bhiwandi',
#     'Bhokar',
#     'Bhokardan',
#     'Bhoom',
#     'Bhor',
#     'Bhor Interior',
#     'Bhosari',
#     'Bhosari,Midc',
#     'Bhuranpur',
#     'Bhusawal',
#     'Bibwewadi, Undri, Upper',
#     'Boda',
#     'Bodhwad',
#     'Boiser/Umroli',
#     'Buldana',
#     'Candbad',
#     'Canteen Suplier',
#     'Central Railway',
#     'Chakur',
#     'Chalisgaon',
#     'Chandrapur',
#     'Chandrapur',
#     'Chandrapur',
#     'Chandrapur',
#     'Chandrapur',
#     'Chincholi',
#     'Chincholi',
#     'Chinchwad',
#     'Chiplun',
#     'Chittorgarh',
#     'Dadar',
#     'Daund Local',
#     'Daund Rly',
#     'Deglur',
#     'Deola',
#     'Devni',
#     'Dhaiwadi',
#     'Dhalegaon',
#     'Dharangaon',
#     'Dharavi',
#     'Dharavi',
#     'Dharavi',
#     'Dharnii',
#     'Digha',
#     'Dindori',
#     'Diva',
#     'Docyard Road',
#     'Docyard Road',
#     'Docyard Road',
#     'Dombivali',
#     'Dondaicha',
#     'Falna',
#     'Fondshiras',
#     'Fulambri',
#     'Gachiroli',
#     'Gangapur',
#     'Gevraie',
#     'Ghansangvi',
#     'Ghatkopar East',
#     'Ghodap Dev',
#     'Ghodpeth',
#     'Gondpipri',
#     'Goregaon',
#     'Goregoan W',
#     'Govandi',
#     'Gudamalani',
#     'Guvaghar',
#     'Hadgaon',
#     'Harji',
#     'Himayatnagar',
#     'Hingoli',
#     'Ichawar',
#     'Indapur',
#     'Indore',
#     'Indore',
#     'Indore',
#     'Interior Area',
#     'Jadhavwadi, Chikhali',
#     'Jafrabad',
#     'Jaisalmer',
#     'Jalna',
#     'Jamkhed',
#     'Jeur',
#     'Jintur',
#     'Jogeshwari/Goregaon E',
#     'Jogeshwari/Malad W',
#     'Junnar',
#     'K.Bhima',
#     'Kahandwa',
#     'Kalamb',
#     'Kalewadi',
#     'Kalwa',
#     'Kalyan',
#     'Kalyan (E)',
#     'Kamathi Pura',
#     'Kamothe',
#     'Kannad',
#     'Karanja Lad',
#     'Karanja Lad',
#     'Karanji',
#     'Karjat',
#     'Katraj',
#     'Kawas',
#     'Kej',
#     'Khadki',
#     'Khamgaon',
#     'Khandala / Lonavala',
#     'Khar To Nsp Railway',
#     'Khed',
#     'Khed And Interior',
#     'Khed To Alephata',
#     'Khilchpur',
#     'Khilchpur',
#     'Khilchpur',
#     'Khilchpur',
#     'Khilchpur',
#     'Khknar',
#     'Khudus',
#     'Khutbav',
#     'Kinvat',
#     'Kolad',
#     'Kondwa',
#     'Koregaon',
#     'Korpana',
#     'Kurdwadi',
#     'Kurla East',
#     'Kurla East',
#     'Kurla Tilak Nager',
#     'Kurla West',
#     'Latur',
#     'Local',
#     'Local Satara',
#     'Loha & Naigaon',
#     'Lohagaon,Dhanori',
#     'Lonand',
#     'Lonar',
#     'Mahim To Dadar',
#     'Majalgaon',
#     'Maksi',
#     'Malegaon',
#     'Malegaon',
#     'Malegaon',
#     'Malkapur',
#     'Mands',
#     'Majalgaon',
#     'Maksi',
#     'Malegaon',
#     'Malegaon',
#     'Malegaon',
#     'Malkapur',
#     'Mandsore',
#     'Mangalvedha',
#     'Mangaon',
#     'Manmad',
#     'Manohanr Thana',
#     'Manoj Jain',
#     'Mantha',
#     'Manvat',
#     'Mapusa',
#     'Mehakar',
#     'Mira Rd',
#     'Mira Rd To Dahanu',
#     'Morgaon,Supa',
#     'Mukhed',
#     'Mulund',
#     'Mumbra',
#     'Naigaon',
#     'Nalasopara To Bandra',
#     'Nandafata',
#     'Nanded',
#     'Nanded Tal Interior',
#     'Nandura',
#     'Nandurbar',
#     'Nandurghat',
#     'Narangvadi',
#     'Nashik',
#     'Nashik',
#     'Nashik',
#     'Nashik',
#     'Nashik',
#     'Ner Dhule',
#     'Nerul',
#     'New Nanded',
#     'Nigdi, Mamurdi',
#     'Nimach',
#     'Nimgaon, Bavda',
#     'Nira',
#     'Nitoda',
#     'Nitur',
#     'Oni',
#     'Osmanabad',
#     'Paithan',
#     'Paithan',
#     'Palam',
#     'Pali',
#     'Panchincholi',
#     'Pandharpur',
#     'Pandharpur',
#     'Panvel',
#     'Parali',
#     'Paratwada',
#     'Parbhani',
#     'Partur',
#     'Pathri',
#     'Pcmc',
#     'Pednem',
#     'Pen',
#     'Peth Area.',
#     'Phaltan Interior',
#     'Phaltan Local',
#     'Phonda',
#     'Pusad',
#     'Rabale',
#     'Rahata',
#     'Rajgrh',
#     'Rajura',
#     'Ramesh',
#     'Rani',
#     'Rani',
#     'Rashin &Interior',
#     'Ratnagiri',
#     'Rey Road ',
#     'Rly Pune',
#     'Sadri',
#     'Sainathnagar, W.Sheri,',
#     'Sanchore',
#     'Sanderav',
#     'Sangam Nager',
#     'Sangola',
#     'Sanmeshwar',
#     'Saphale/Kelve',
#     'Satana',
#     'Savargaon',
#     'Sehore',
#     'Sehore',
#     'Serwa',
#     'Shahagad',
#     'Shegaon',
#     'Sheo',
#     'Sheoganj',
#     'Sheoganj',
#     'Shilphata',
#     'Shirpur',
#     'Shirval',
#     'Shriwardhan',
#     'Sikar',
#     'Sillod',
#     'Sindgaon',
#     'Sindhakhed Raja',
#     'Sindhri',
#     'Sinnar',
#     'Solapur',
#     'Solapur',
#     'Solapur Rail',
#     'Sumerpur',
#     'Swaroopganj',
#     'Tajpur',
#     'Talegaon',
#     'Talen',
#     'Taloja',
#     'Thane',
#     'Thane',
#     'Thane',
#     'Tirthpuri',
#     'Titwala',
#     'Tuljapur',
#     'Tuljapur',
#     'Udaipur',
#     'Udgir',
#     'Ujjain',
#     'Ujjain',
#     'Ulhasanagar',
#     'Ulhasanagar',
#     'Ulhasnagar',
#     'Ulhasnagar 4-5',
#     'Ulhasnagar/ Ambernath',
#     'Umarga',
#     'Umari',
#     'Urlikanchan',
#     'Vaijapur',
#     'Vairag',
#     'Vangani',
#     'Vasai(E) Nsp (W)',
#     'Vashi',
#     'Vashi',
#     'Vashi Naka',
#     'Wadala Truck Terminal',
#     'Wadala Truck Traminal',
#     'Wadsa',
#     'Waduj,Pusegaon',
#     'Wagholi, Ubalenagar',
#     'Wai City',
#     'Walgaon',
#     'Waluj',
#     'Warje, Uttamnagar, Malwadi',
#     'Warora',
#     'Warora',
#     'Washi',
#     'Wathar,Limb,Highway',
#     'Yevatmal',
#     'Yevatmal',
#     'Yevatmal',
#   ]

# places = []

res =[]
for place in places:

    x = search_pincode(f'{place}')
    res.append(x)

SCOPES = ['https://www.googleapis.com/auth/spreadsheets']

# spredsheet example: https://docs.google.com/spreadsheets/d/1k9b6bUdMQ-bBUIBPAoW539VGpQtTVwr77tT24c-98Ui/edit#gid=0

SAMPLE_SPREADSHEET_ID = 'b6bUdMQ-bBUIBPAoW539VGpQtTVwr77tT24c-98Ui' # id from example

def update_google_sheet( pin_codes):  
    '''
    :param pin_codes: list of pinocdes
    :return: None
    '''
    # Connect to Google Sheets API
    scopes = ['https://www.googleapis.com/auth/spreadsheets', 'https://www.googleapis.com/auth/drive']

    creds = ServiceAccountCredentials.from_json_keyfile_name('./google_credentials.json', scopes)
    service = build('sheets', 'v4', credentials=creds)
    sheet = service.spreadsheets()
    sheet.values().append(spreadsheetId=SAMPLE_SPREADSHEET_ID,
                                                    range="Sheet2!A2",
                                                    valueInputOption='USER_ENTERED',
                                                    insertDataOption='INSERT_ROWS',
                                                    body={"values": pin_codes}).execute()

update_google_sheet(res)
